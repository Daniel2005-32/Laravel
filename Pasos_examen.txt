1. Preparaci√≥n del Sistema
1.1 Actualizar Sistema Operativo
bash
sudo apt update && sudo apt upgrade -y
sudo apt autoremove -y
sudo apt autoclean -y
1.2 Verificar versi√≥n de Ubuntu
bash
lsb_release -a
2. Instalaci√≥n de PHP y Dependencias
2.1 Agregar repositorio de PHP
bash
sudo apt install software-properties-common -y
sudo add-apt-repository ppa:ondrej/php -y
sudo apt update
2.2 Instalar PHP 8.2 (Laravel 11 requiere PHP 8.1+)
bash
sudo apt install php8.2 php8.2-cli php8.2-common php8.2-mysql php8.2-zip php8.2-gd php8.2-mbstring php8.2-curl php8.2-xml php8.2-bcmath -y
2.3 Instalar extensiones adicionales recomendadas
bash
sudo apt install php8.2-pdo php8.2-tokenizer php8.2-ctype php8.2-json php8.2-dom php8.2-simplexml -y
2.4 Verificar instalaci√≥n de PHP
bash
php -v
php --modules | grep -E 'mbstring|xml|bcmath|curl|zip|pdo|tokenizer|ctype|json'
3. Instalaci√≥n de Composer
3.1 Descargar e instalar Composer
bash
curl -sS https://getcomposer.org/installer -o composer-setup.php
sudo php composer-setup.php --install-dir=/usr/local/bin --filename=composer
rm composer-setup.php
3.2 Verificar instalaci√≥n de Composer
bash
composer --version
composer diagnose
3.3 Configurar Composer (opcional)
bash
composer config -g repo.packagist composer https://packagist.org
composer config -g process-timeout 2000
4. Configuraci√≥n de Servidor Web
4.1 Instalar Apache
bash
sudo apt install apache2 libapache2-mod-php8.2 -y
4.2 Activar m√≥dulos necesarios
bash
sudo a2enmod rewrite
sudo a2enmod headers
sudo a2enmod env
sudo a2enmod dir
sudo a2enmod mime
4.3 Verificar estado de Apache
bash
sudo systemctl status apache2
sudo apache2ctl -M | grep rewrite
4.4 Soluci√≥n de problemas Apache
Si hay problemas con Apache:
bash
# Reiniciar Apache
sudo systemctl restart apache2

# Ver logs de errores
sudo tail -f /var/log/apache2/error.log

# Ver configuraci√≥n
sudo apache2ctl -S
5. Instalaci√≥n y Configuraci√≥n de MySQL
5.1 Instalar MySQL Server
bash
sudo apt install mysql-server php8.2-mysql -y
5.2 Configurar seguridad de MySQL
bash
sudo mysql_secure_installation
Durante este proceso:
Presiona Enter para la contrase√±a actual (vac√≠a si es nueva instalaci√≥n)
Configura contrase√±a root cuando te pregunte
Selecciona Y para todas las opciones de seguridad
5.3 Acceder a MySQL y crear base de datos
bash
sudo mysql -u root -p
Dentro de MySQL ejecutar:
sql
-- Crear base de datos
CREATE DATABASE laravel_db CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci;

-- Crear usuario
CREATE USER 'laravel_user'@'localhost' IDENTIFIED BY 'TuContrase√±aSegura123!';

-- Otorgar privilegios
GRANT ALL PRIVILEGES ON laravel_db.* TO 'laravel_user'@'localhost';

-- Privilegios adicionales para procedimientos (si se necesitan)
GRANT CREATE ROUTINE, ALTER ROUTINE ON laravel_db.* TO 'laravel_user'@'localhost';

-- Aplicar cambios
FLUSH PRIVILEGES;

-- Verificar
SHOW DATABASES;
SELECT user, host FROM mysql.user;

-- Salir
EXIT;
5.4 Probar conexi√≥n MySQL
bash
mysql -u laravel_user -p -e "SHOW DATABASES;"
5.5 Soluci√≥n de problemas MySQL
Si hay problemas de conexi√≥n:
bash
# Reiniciar MySQL
sudo systemctl restart mysql

# Verificar estado
sudo systemctl status mysql

# Ver logs
sudo tail -f /var/log/mysql/error.log
6. Instalaci√≥n de Laravel
6.1 Crear directorio del proyecto
bash
sudo mkdir -p /var/www/laravel
sudo chown -R $USER:$USER /var/www/laravel
cd /var/www/laravel
6.2 Instalar Laravel 11
bash
composer create-project --prefer-dist laravel/laravel:^11.0 laravel-app
6.3 Verificar instalaci√≥n
bash
cd /var/www/laravel/laravel-app
php artisan --version
6.4 Soluci√≥n de problemas instalaci√≥n Laravel
Si hay problemas de permisos:
bash
# Otorgar permisos
sudo chown -R www-data:www-data /var/www/laravel/laravel-app
sudo chmod -R 775 /var/www/laravel/laravel-app/storage
sudo chmod -R 775 /var/www/laravel/laravel-app/bootstrap/cache

# Verificar
ls -la /var/www/laravel/laravel-app/storage/
7. Configuraci√≥n del Proyecto Laravel
7.1 Configurar archivo .env
bash
cd /var/www/laravel/laravel-app
cp .env.example .env
Editar el archivo .env:
bash
nano .env
Configurar:
env
APP_NAME=Laravel
APP_ENV=local
APP_KEY=
APP_DEBUG=true
APP_URL=http://laravel.local

DB_CONNECTION=mysql
DB_HOST=127.0.0.1
DB_PORT=3306
DB_DATABASE=laravel_db
DB_USERNAME=laravel_user
DB_PASSWORD=TuContrase√±aSegura123!
7.2 Generar key de aplicaci√≥n
bash
php artisan key:generate
7.3 Verificar configuraci√≥n .env
bash
php artisan env
7.4 Configurar cache
bash
php artisan config:cache
php artisan route:cache
php artisan view:cache
8. Configuraci√≥n de Base de Datos
8.1 Ejecutar migraciones
bash
php artisan migrate --force
8.2 Verificar migraciones ejecutadas
bash
php artisan migrate:status
8.3 Crear seeder de prueba
bash
php artisan make:seeder UsersTableSeeder
Editar database/seeders/UsersTableSeeder.php:
php
<?php

namespace Database\Seeders;

use Illuminate\Database\Seeder;
use Illuminate\Support\Facades\DB;
use Illuminate\Support\Facades\Hash;

class UsersTableSeeder extends Seeder
{
    public function run()
    {
        DB::table('users')->insert([
            'name' => 'Admin',
            'email' => 'admin@example.com',
            'password' => Hash::make('password'),
            'email_verified_at' => now(),
            'created_at' => now(),
            'updated_at' => now(),
        ]);
    }
}
8.4 Ejecutar seeders
bash
php artisan db:seed --class=UsersTableSeeder
8.5 Soluci√≥n de problemas de base de datos
Si hay errores de conexi√≥n:
bash
# Probar conexi√≥n manualmente
php artisan tinker
# Dentro de tinker:
DB::connection()->getPdo();
exit;

# Limpiar cache
php artisan config:clear
php artisan cache:clear

# Reintentar migraci√≥n
php artisan migrate:fresh --seed
9. Configuraci√≥n del Virtual Host en Apache
9.1 Crear archivo de configuraci√≥n
bash
sudo nano /etc/apache2/sites-available/laravel-app.conf
Agregar:
apache
<VirtualHost *:80>
    ServerName laravel.local
    ServerAdmin webmaster@localhost
    DocumentRoot /var/www/laravel/laravel-app/public
    
    <Directory /var/www/laravel/laravel-app>
        Options Indexes FollowSymLinks
        AllowOverride All
        Require all granted
    </Directory>
    
    <Directory /var/www/laravel/laravel-app/public>
        Options -Indexes +FollowSymLinks
        AllowOverride All
        Require all granted
    </Directory>
    
    ErrorLog ${APACHE_LOG_DIR}/laravel-app-error.log
    CustomLog ${APACHE_LOG_DIR}/laravel-app-access.log combined
    
    # Headers de seguridad
    Header always set X-Content-Type-Options nosniff
    Header always set X-Frame-Options "SAMEORIGIN"
    Header always set X-XSS-Protection "1; mode=block"
</VirtualHost>
9.2 Habilitar sitio y deshabilitar default
bash
sudo a2dissite 000-default.conf
sudo a2ensite laravel-app.conf
9.3 Configurar permisos
bash
sudo chown -R www-data:www-data /var/www/laravel/laravel-app
sudo chmod -R 755 /var/www/laravel/laravel-app
sudo chmod -R 775 /var/www/laravel/laravel-app/storage
sudo chmod -R 775 /var/www/laravel/laravel-app/bootstrap/cache
9.4 Reiniciar Apache
bash
sudo systemctl restart apache2
sudo apache2ctl configtest
10. Configurar hosts local
10.1 Editar archivo hosts
bash
sudo nano /etc/hosts
Agregar al final:
text
127.0.0.1    laravel.local
127.0.0.1    www.laravel.local
10.2 Verificar configuraci√≥n DNS
bash
ping laravel.local
nslookup laravel.local
11. Probar Instalaci√≥n
11.1 Probar en navegador
Abrir: http://laravel.local
11.2 Probar con curl
bash
curl -I http://laravel.local
11.3 Verificar logs
bash
# Ver logs de Apache
sudo tail -f /var/log/apache2/laravel-app-error.log

# Ver logs de Laravel
tail -f /var/www/laravel/laravel-app/storage/logs/laravel.log
12. Comandos Artisan √ötiles
12.1 Comandos de desarrollo
bash
# Iniciar servidor de desarrollo
php artisan serve
php artisan serve --host=0.0.0.0 --port=8000

# Limpiar caches
php artisan cache:clear
php artisan config:clear
php artisan route:clear
php artisan view:clear

# Optimizar
php artisan optimize
php artisan optimize:clear
12.2 Comandos de base de datos
bash
# Crear migraci√≥n
php artisan make:migration create_tabla_nombre --create=tabla_nombre

# Ejecutar migraci√≥n espec√≠fica
php artisan migrate --path=/database/migrations/archivo_migracion.php

# Rollback
php artisan migrate:rollback --step=1
php artisan migrate:reset

# Fresh install
php artisan migrate:fresh --seed
12.3 Comandos de generaci√≥n
bash
# Crear modelo con migraci√≥n y controlador
php artisan make:model Producto -mc

# Crear controlador resource
php artisan make:controller ProductoController --resource

# Crear factory
php artisan make:factory ProductoFactory

# Crear policy
php artisan make:policy ProductoPolicy
13. Configuraci√≥n Adicional Recomendada
13.1 Configurar Storage Link
bash
php artisan storage:link
13.2 Configurar Queue (si se usa)
bash
# Crear tabla de jobs
php artisan queue:table
php artisan migrate

# Probar queue worker
php artisan queue:work --tries=3
13.3 Configurar Schedule
bash
# Agregar al crontab
(crontab -l ; echo "* * * * * cd /var/www/laravel/laravel-app && php artisan schedule:run >> /dev/null 2>&1") | crontab -

# Verificar
crontab -l
14. Script de Respaldo y Restauraci√≥n
14.1 Script de respaldo
Crear backup-laravel.sh:
bash
#!/bin/bash
DATE=$(date +%Y%m%d_%H%M%S)
BACKUP_DIR="/backups/laravel"

mkdir -p $BACKUP_DIR

# Backup de base de datos
mysqldump -u laravel_user -p'TuContrase√±aSegura123!' laravel_db > $BACKUP_DIR/db_backup_$DATE.sql

# Backup de archivos
tar -czf $BACKUP_DIR/files_backup_$DATE.tar.gz /var/www/laravel/laravel-app

echo "Backup completado: $BACKUP_DIR/backup_$DATE"
14.2 Script de restauraci√≥n
Crear restore-laravel.sh:
bash
#!/bin/bash
BACKUP_FILE=$1

if [ -z "$BACKUP_FILE" ]; then
    echo "Uso: $0 <archivo_backup>"
    exit 1
fi

# Restaurar base de datos
mysql -u laravel_user -p'TuContrase√±aSegura123!' laravel_db < $BACKUP_FILE

echo "Restauraci√≥n completada"
15. Verificaci√≥n Final
15.1 Comprobar estado completo
bash
# Verificar servicios
sudo systemctl status apache2
sudo systemctl status mysql

# Verificar PHP
php -m

# Verificar Composer
composer --version

# Verificar Laravel
cd /var/www/laravel/laravel-app
php artisan --version

# Probar conexi√≥n a DB
php artisan tinker
DB::connection()->getPdo();
15.2 Comandos de diagn√≥stico
bash
# Ver todas las rutas
php artisan route:list

# Ver entorno
php artisan env

# Ver configuraci√≥n
php artisan config:show

# Ver servicios
php artisan down
php artisan up
16. Soluci√≥n de Problemas Comunes
16.1 Permisos de archivos
bash
# Soluci√≥n general de permisos
sudo chown -R www-data:www-data /var/www/laravel/laravel-app
sudo find /var/www/laravel/laravel-app -type f -exec chmod 644 {} \;
sudo find /var/www/laravel/laravel-app -type d -exec chmod 755 {} \;
sudo chmod -R 775 /var/www/laravel/laravel-app/storage
sudo chmod -R 775 /var/www/laravel/laravel-app/bootstrap/cache
16.2 Problemas de Apache
bash
# Reiniciar completo
sudo systemctl stop apache2
sudo systemctl start apache2
sudo systemctl status apache2

# Ver errores
sudo apache2ctl configtest
sudo tail -50 /var/log/apache2/error.log
16.3 Problemas de MySQL
bash
# Reiniciar servicio
sudo systemctl restart mysql

# Reparar tablas
mysqlcheck -u laravel_user -p --auto-repair --optimize laravel_db
16.4 Problemas de Composer
bash
# Limpiar cache
composer clear-cache

# Reinstalar dependencias
rm -rf vendor
rm composer.lock
composer install --no-dev --optimize-autoloader


Ra√≠z del proyecto (/laravel-app/)
text
laravel-app/
‚îú‚îÄ‚îÄ app/                    # ‚òÖ‚òÖ‚òÖ N√öCLEO DE LA APLICACI√ìN ‚òÖ‚òÖ‚òÖ
‚îú‚îÄ‚îÄ bootstrap/              # Inicializaci√≥n de Laravel
‚îú‚îÄ‚îÄ config/                 # ‚òÖ‚òÖ‚òÖ CONFIGURACIONES ‚òÖ‚òÖ‚òÖ
‚îú‚îÄ‚îÄ database/               # ‚òÖ‚òÖ‚òÖ BASE DE DATOS ‚òÖ‚òÖ‚òÖ
‚îú‚îÄ‚îÄ public/                 # ‚òÖ‚òÖ‚òÖ CARPETA P√öBLICA ‚òÖ‚òÖ‚òÖ
‚îú‚îÄ‚îÄ resources/              # ‚òÖ‚òÖ‚òÖ RECURSOS Y VISTAS ‚òÖ‚òÖ‚òÖ
‚îú‚îÄ‚îÄ routes/                 # ‚òÖ‚òÖ‚òÖ RUTAS ‚òÖ‚òÖ‚òÖ
‚îú‚îÄ‚îÄ storage/                # Archivos generados
‚îú‚îÄ‚îÄ tests/                  # Pruebas
‚îî‚îÄ‚îÄ vendor/                 # Dependencias de Composer

üìÇ CARPETAS PRINCIPALES - PARA QU√â SIRVEN
1. app/ - EL CORAZ√ìN DE TU APLICACI√ìN
text
app/
‚îú‚îÄ‚îÄ Console/          # Comandos Artisan personalizados
‚îú‚îÄ‚îÄ Exceptions/       # Manejo de excepciones
‚îú‚îÄ‚îÄ Http/             # ‚òÖ‚òÖ‚òÖ LO M√ÅS IMPORTANTE ‚òÖ‚òÖ‚òÖ
‚îÇ   ‚îú‚îÄ‚îÄ Controllers/  # Controladores (l√≥gica de negocio)
‚îÇ   ‚îú‚îÄ‚îÄ Middleware/   # Interceptores de peticiones
‚îÇ   ‚îî‚îÄ‚îÄ Kernel.php    # Config middleware
‚îú‚îÄ‚îÄ Models/           # ‚òÖ‚òÖ‚òÖ MODELOS (Base de datos) ‚òÖ‚òÖ‚òÖ
‚îú‚îÄ‚îÄ Providers/        # Proveedores de servicio
‚îî‚îÄ‚îÄ Services/         # Servicios reutilizables
¬øQu√© hago aqu√≠ normalmente?
Crear nuevos controladores: php artisan make:controller LibroController
Crear modelos: php artisan make:model Libro
A√±adir l√≥gica de negocio
Validar datos

2. database/ - TODO SOBRE BASE DE DATOS
text
database/
‚îú‚îÄ‚îÄ factories/        # Datos de prueba
‚îú‚îÄ‚îÄ migrations/       # ‚òÖ‚òÖ‚òÖ ESTRUCTURA DE TABLAS ‚òÖ‚òÖ‚òÖ
‚îú‚îÄ‚îÄ seeders/         # ‚òÖ‚òÖ‚òÖ DATOS INICIALES ‚òÖ‚òÖ‚òÖ
‚îî‚îÄ‚îÄ (connection config en config/database.php)
¬øQu√© hago aqu√≠ normalmente?
bash
# Crear nueva tabla
php artisan make:migration create_libros_table

# Poblar con datos
php artisan make:seeder LibrosSeeder

# Ejecutar
php artisan migrate
php artisan db:seed --class=LibrosSeeder

3. resources/ - LO QUE VE EL USUARIO
text
resources/
‚îú‚îÄ‚îÄ css/             # Estilos
‚îú‚îÄ‚îÄ js/              # JavaScript
‚îú‚îÄ‚îÄ views/           # ‚òÖ‚òÖ‚òÖ VISTAS (HTML/PHP) ‚òÖ‚òÖ‚òÖ
‚îÇ   ‚îú‚îÄ‚îÄ auth/        # Login/registro
‚îÇ   ‚îú‚îÄ‚îÄ layouts/     # Plantillas base
‚îÇ   ‚îî‚îÄ‚îÄ (tus vistas)
‚îî‚îÄ‚îÄ lang/            # Traducciones
¬øQu√© hago aqu√≠ normalmente?
Crear nuevas vistas: libros/index.blade.php
Modificar dise√±o
A√±adir JavaScript/CSS

4. routes/ - MAPA DE LA APLICACI√ìN
text
routes/
‚îú‚îÄ‚îÄ web.php          # ‚òÖ‚òÖ‚òÖ RUTAS WEB (con sesi√≥n) ‚òÖ‚òÖ‚òÖ
‚îú‚îÄ‚îÄ api.php          # Rutas API
‚îú‚îÄ‚îÄ console.php      # Comandos Artisan
‚îî‚îÄ‚îÄ channels.php     # WebSockets
¬øQu√© hago aqu√≠ normalmente?
php
// A√±adir nuevas rutas
Route::get('/libros', [LibroController::class, 'index'])->name('libros.index');
Route::post('/libros', [LibroController::class, 'store'])->name('libros.store');

5. config/ - AJUSTES DE LA APLICACI√ìN
text
config/
‚îú‚îÄ‚îÄ app.php          # Config general
‚îú‚îÄ‚îÄ auth.php         # ‚òÖ‚òÖ‚òÖ AUTENTICACI√ìN ‚òÖ‚òÖ‚òÖ
‚îú‚îÄ‚îÄ database.php     # Conexi√≥n BD
‚îú‚îÄ‚îÄ filesystems.php  # Archivos
‚îî‚îÄ‚îÄ (otros archivos)
¬øQu√© hago aqu√≠ normalmente?
Cambiar timezone: config/app.php
Configurar email
Ajustar autenticaci√≥n

üõ†Ô∏è C√ìMO A√ëADIR NUEVOS APARTADOS (Ejemplo: "Autores")
PASO 1: Crear la tabla en la base de datos
bash
# Crear migraci√≥n
php artisan make:migration create_autores_table

# Editar el archivo generado en database/migrations/
Ejemplo de migraci√≥n:
php
public function up()
{
    Schema::create('autores', function (Blueprint $table) {
        $table->id();
        $table->string('nombre');
        $table->string('email')->unique();
        $table->text('biografia')->nullable();
        $table->timestamps(); // created_at y updated_at
    });
}
PASO 2: Crear el Modelo
bash
php artisan make:model Autor
Archivo app/Models/Autor.php:
php
namespace App\Models;

use Illuminate\Database\Eloquent\Factories\HasFactory;
use Illuminate\Database\Eloquent\Model;

class Autor extends Model
{
    use HasFactory;

    // Campos que se pueden llenar masivamente
    protected $fillable = ['nombre', 'email', 'biografia'];
    
    // Si quieres relaci√≥n con libros (uno a muchos)
    public function libros()
    {
        return $this->hasMany(Libro::class);
    }
}
PASO 3: Crear el Controlador
bash
php artisan make:controller AutorController --resource
Esto crea m√©todos para:
index() - Listar todos
create() - Formulario crear
store() - Guardar nuevo
show() - Mostrar uno
edit() - Formulario editar
update() - Actualizar
destroy() - Eliminar
PASO 4: Crear las Vistas
En resources/views/autores/:
text
autores/
‚îú‚îÄ‚îÄ index.blade.php    # Lista de autores
‚îú‚îÄ‚îÄ create.blade.php   # Formulario crear
‚îú‚îÄ‚îÄ edit.blade.php     # Formulario editar
‚îî‚îÄ‚îÄ show.blade.php     # Ver detalle
Ejemplo index.blade.php:
blade
@extends('layouts.app')

@section('content')
<div class="container">
    <h1>Autores</h1>
    
    <a href="{{ route('autores.create') }}" class="btn btn-primary mb-3">
        Nuevo Autor
    </a>
    
    <table class="table">
        <thead>
            <tr>
                <th>ID</th>
                <th>Nombre</th>
                <th>Email</th>
                <th>Acciones</th>
            </tr>
        </thead>
        <tbody>
            @foreach($autores as $autor)
            <tr>
                <td>{{ $autor->id }}</td>
                <td>{{ $autor->nombre }}</td>
                <td>{{ $autor->email }}</td>
                <td>
                    <a href="{{ route('autores.edit', $autor) }}" class="btn btn-sm btn-warning">
                        Editar
                    </a>
                    <form action="{{ route('autores.destroy', $autor) }}" method="POST" class="d-inline">
                        @csrf
                        @method('DELETE')
                        <button type="submit" class="btn btn-sm btn-danger" 
                                onclick="return confirm('¬øEliminar autor?')">
                            Eliminar
                        </button>
                    </form>
                </td>
            </tr>
            @endforeach
        </tbody>
    </table>
</div>
@endsection
PASO 5: Definir las Rutas
En routes/web.php:
php
// A√±adir al final del archivo
Route::resource('autores', AutorController::class)
    ->middleware(['auth']); // Solo usuarios autenticados
PASO 6: Actualizar el Men√∫ de Navegaci√≥n
En resources/views/layouts/app.blade.php (o donde tengas el men√∫):
blade
<!-- Buscar el men√∫ y a√±adir: -->
<li class="nav-item">
    <a class="nav-link" href="{{ route('autores.index') }}">
        <i class="fas fa-users"></i> Autores
    </a>
</li>

üîß MODIFICACIONES COMUNES - GU√çA R√ÅPIDA
1. Cambiar Rutas Existentes
php
// Cambiar URL de acceso
Route::get('/mis-libros', [LibroController::class, 'index'])
    ->name('libros.mios')
    ->middleware('auth');

// Redireccionar ruta antigua a nueva
Route::redirect('/libros', '/mis-libros', 301);
2. A√±adir Condiciones (Middleware)
php
// Solo administradores
Route::get('/admin', [AdminController::class, 'index'])
    ->middleware(['auth', 'admin']);

// Crear middleware personalizado:
php artisan make:middleware AdminMiddleware
Configurar en app/Http/Kernel.php:
php
protected $routeMiddleware = [
    'admin' => \App\Http\Middleware\AdminMiddleware::class,
];
3. A√±adir Campos a Tablas Existentes
bash
# Crear migraci√≥n para a√±adir campo
php artisan make:migration add_telefono_to_autores_table
Migraci√≥n:
php
public function up()
{
    Schema::table('autores', function (Blueprint $table) {
        $table->string('telefono')->nullable()->after('email');
    });
}
Actualizar Modelo:
php
protected $fillable = ['nombre', 'email', 'telefono', 'biografia'];
4. Crear Relaciones entre Tablas
Si un Autor tiene muchos Libros:
php
// En Autor.php
public function libros()
{
    return $this->hasMany(Libro::class);
}

// En Libro.php
public function autor()
{
    return $this->belongsTo(Autor::class);
}
Usar en Controlador:
php
// Obtener libros de un autor
$autor = Autor::find(1);
$libros = $autor->libros;

// Obtener autor de un libro
$libro = Libro::find(1);
$autorNombre = $libro->autor->nombre;
5. Validar Formularios
En el Controlador:
php
public function store(Request $request)
{
    $validated = $request->validate([
        'nombre' => 'required|string|max:100',
        'email' => 'required|email|unique:autores',
        'telefono' => 'nullable|string|max:20',
        'biografia' => 'nullable|string|max:1000',
    ]);
    
    Autor::create($validated);
    
    return redirect()->route('autores.index')
        ->with('success', 'Autor creado correctamente');
}

üé® MEJORAR LA INTERFAZ
A√±adir Bootstrap/Icons (si no los tienes)
bash
npm install bootstrap @popperjs/core
npm install @fortawesome/fontawesome-free
En resources/css/app.css:
css
@import 'bootstrap';
@import '@fortawesome/fontawesome-free/css/all.css';
Crear Layouts Reutilizables
resources/views/layouts/admin.blade.php:
blade
<!DOCTYPE html>
<html>
<head>
    <title>Admin - @yield('title')</title>
    <!-- Bootstrap CSS -->
</head>
<body>
    <nav>... Men√∫ admin ...</nav>
    
    <div class="container">
        @yield('content')
    </div>
    
    <!-- Bootstrap JS -->
</body>
</html>
Usar en vista:
blade
@extends('layouts.admin')

@section('title', 'Panel de Control')

@section('content')
    <h1>Bienvenido al panel</h1>
    <!-- Contenido espec√≠fico -->
@endsection

üîê SEGURIDAD Y AUTENTICACI√ìN
Modificar Login/Registro
Archivos: resources/views/auth/
Controladores: app/Http/Controllers/Auth/
Config: config/auth.php
A√±adir Roles
Migraci√≥n para roles:
bash
php artisan make:migration add_role_to_users_table
php
public function up()
{
    Schema::table('users', function (Blueprint $table) {
        $table->enum('role', ['user', 'admin'])->default('user');
    });
}
Middleware para verificar rol:
php
public function handle($request, Closure $next, $role)
{
    if (!auth()->check() || auth()->user()->role !== $role) {
        abort(403, 'No autorizado');
    }
    
    return $next($request);
}

üìä A√ëADIR ESTAD√çSTICAS O DASHBOARD
Crear DashboardController
bash
php artisan make:controller DashboardController
En el controlador:
php
public function index()
{
    $stats = [
        'totalLibros' => Libro::count(),
        'totalAutores' => Autor::count(),
        'ultimosLibros' => Libro::latest()->take(5)->get(),
        'usuariosRegistrados' => User::whereMonth('created_at', now()->month)->count(),
    ];
    
    return view('dashboard.index', compact('stats'));
}

üö® SOLUCI√ìN DE PROBLEMAS COMUNES
"No se encuentra la ruta"
bash
# Listar todas las rutas
php artisan route:list

# Limpiar cache de rutas
php artisan route:clear
"Error al migrar"
bash
# Revertir √∫ltima migraci√≥n
php artisan migrate:rollback

# Forzar migraciones
php artisan migrate --force

# Ver estado
php artisan migrate:status
"Vista no encontrada"
bash
# Limpiar cache de vistas
php artisan view:clear
php artisan cache:clear

# Verificar que la vista existe
ls -la resources/views/tu_carpeta/
"Error 419 - Token CSRF"
A√±adir en formularios:
blade
@csrf

üìã CHECKLIST PARA NUEVO M√ìDULO
‚úÖ 1. php artisan make:model Modelo -m (crea modelo y migraci√≥n)
‚úÖ 2. Editar migraci√≥n en database/migrations/
‚úÖ 3. php artisan migrate
‚úÖ 4. php artisan make:controller ModeloController --resource
‚úÖ 5. Crear vistas en resources/views/modelos/
‚úÖ 6. A√±adir rutas en routes/web.php
‚úÖ 7. Actualizar men√∫ de navegaci√≥n
‚úÖ 8. php artisan make:seeder ModeloSeeder (opcional)
‚úÖ 9. Probar todo el flujo

üí° CONSEJOS FINALES
Usa nombres en ingl√©s para consistencia
Sigue convenciones: Controladores en plural (BooksController)
Documenta cambios importantes
Haz commits frecuentes con Git
Prueba cada nueva funcionalidad
Mant√©n composer.json y package.json actualizados
Usa .env para configuraciones sensibles
Revisa logs cuando algo falle: storage/logs/laravel.log

üéØ PR√ìXIMOS PASOS RECOMENDADOS
API REST si necesitas conectar con apps m√≥viles
Eventos y Listeners para acciones autom√°ticas
Jobs y Queues para tareas pesadas
Notificaciones por email
Testing con PHPUnit
Despliegue a producci√≥n

1. Configuraci√≥n Inicial
A√±adir jQuery (si quieres usarlo)
html
<!-- En el layout principal (resources/views/layouts/app.blade.php) -->
<head>
    <!-- ... otros meta ... -->
    <meta name="csrf-token" content="{{ csrf_token() }}">
</head>
<body>
    <!-- ... contenido ... -->
    
    <!-- jQuery para AJAX (opcional pero √∫til) -->
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    
    <!-- O si prefieres vanilla JavaScript (moderno) -->
    <script>
        // Configurar CSRF token para todas las peticiones AJAX
        $.ajaxSetup({
            headers: {
                'X-CSRF-TOKEN': $('meta[name="csrf-token"]').attr('content')
            }
        });
    </script>
</body>
Alternativa: Usar Axios (recomendado para Laravel)
bash
npm install axios
javascript
// resources/js/app.js
import axios from 'axios';

window.axios = axios;
window.axios.defaults.headers.common['X-Requested-With'] = 'XMLHttpRequest';

2. Ejemplo PR√ÅCTICO 1: "Me gusta" en un libro
Paso 1: Crear Ruta API
php
// routes/api.php
Route::post('/libros/{id}/like', [LibroController::class, 'like'])
    ->middleware('auth');

// O en routes/web.php
Route::post('/libros/{libro}/like', [LibroController::class, 'like'])
    ->name('libros.like')
    ->middleware('auth');
Paso 2: Crear M√©todo en Controlador
php
// app/Http/Controllers/LibroController.php
public function like(Libro $libro)
{
    // Verificar si ya dio like
    $like = $libro->likes()
        ->where('user_id', auth()->id())
        ->first();
    
    if ($like) {
        // Quitar like
        $like->delete();
        $liked = false;
    } else {
        // Dar like
        $libro->likes()->create(['user_id' => auth()->id()]);
        $liked = true;
    }
    
    // Contar likes actuales
    $totalLikes = $libro->likes()->count();
    
    // Devolver respuesta JSON
    return response()->json([
        'success' => true,
        'liked' => $liked,
        'totalLikes' => $totalLikes,
        'message' => $liked ? 'Te gusta este libro' : 'Ya no te gusta este libro'
    ]);
}
Paso 3: Crear Migraci√≥n para Likes
bash
php artisan make:migration create_likes_table
php
public function up()
{
    Schema::create('likes', function (Blueprint $table) {
        $table->id();
        $table->foreignId('user_id')->constrained()->onDelete('cascade');
        $table->foreignId('libro_id')->constrained()->onDelete('cascade');
        $table->timestamps();
        
        $table->unique(['user_id', 'libro_id']); // Un like por usuario/libro
    });
}
Paso 4: Actualizar Modelos
php
// app/Models/Libro.php
public function likes()
{
    return $this->hasMany(Like::class);
}

// app/Models/User.php
public function likes()
{
    return $this->hasMany(Like::class);
}

// app/Models/Like.php
class Like extends Model
{
    protected $fillable = ['user_id', 'libro_id'];
}
Paso 5: Crear la Vista con Bot√≥n AJAX
blade
<!-- resources/views/libros/show.blade.php -->
<div class="libro-card">
    <h2>{{ $libro->titulo }}</h2>
    <p>{{ $libro->descripcion }}</p>
    
    <!-- Bot√≥n de like con AJAX -->
    <button id="like-button-{{ $libro->id }}" 
            class="btn-like {{ auth()->user()->haDadoLike($libro) ? 'liked' : '' }}"
            data-libro-id="{{ $libro->id }}">
        
        <i class="fas fa-heart"></i>
        <span id="like-count-{{ $libro->id }}">
            {{ $libro->likes_count }} likes
        </span>
    </button>
</div>

<script>
document.addEventListener('DOMContentLoaded', function() {
    const likeButton = document.getElementById('like-button-{{ $libro->id }}');
    
    likeButton.addEventListener('click', function() {
        const libroId = this.dataset.libroId;
        
        // Mostrar loading
        this.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Cargando...';
        this.disabled = true;
        
        // Enviar petici√≥n AJAX
        fetch(`/libros/${libroId}/like`, {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
                'X-CSRF-TOKEN': document.querySelector('meta[name="csrf-token"]').content,
                'Accept': 'application/json'
            }
        })
        .then(response => response.json())
        .then(data => {
            if (data.success) {
                // Actualizar bot√≥n
                if (data.liked) {
                    likeButton.classList.add('liked');
                    likeButton.innerHTML = '<i class="fas fa-heart"></i> Te gusta';
                } else {
                    likeButton.classList.remove('liked');
                    likeButton.innerHTML = '<i class="far fa-heart"></i> Me gusta';
                }
                
                // Actualizar contador
                document.getElementById(`like-count-${libroId}`).textContent = 
                    `${data.totalLikes} likes`;
                
                // Mostrar mensaje (opcional)
                alert(data.message);
            }
        })
        .catch(error => {
            console.error('Error:', error);
            alert('Error al dar like');
        })
        .finally(() => {
            // Rehabilitar bot√≥n
            this.disabled = false;
        });
    });
});
</script>

<style>
.btn-like {
    background: none;
    border: 2px solid #ccc;
    padding: 8px 16px;
    cursor: pointer;
    border-radius: 20px;
    transition: all 0.3s;
}

.btn-like.liked {
    background: #ff4757;
    color: white;
    border-color: #ff4757;
}

.btn-like:hover {
    transform: scale(1.05);
}
</style>

3. Ejemplo PR√ÅCTICO 2: B√∫squeda con Autocompletado
Paso 1: Ruta para B√∫squeda
php
// routes/web.php
Route::get('/buscar-libros', [LibroController::class, 'buscar'])
    ->name('libros.buscar');
Paso 2: M√©todo en Controlador
php
public function buscar(Request $request)
{
    $query = $request->input('q', '');
    
    if (empty($query)) {
        return response()->json([]);
    }
    
    $libros = Libro::where('titulo', 'LIKE', "%{$query}%")
        ->orWhere('autor', 'LIKE', "%{$query}%")
        ->limit(10)
        ->get(['id', 'titulo', 'autor', 'imagen']);
    
    return response()->json($libros);
}
Paso 3: HTML y JavaScript
blade
<!-- resources/views/partials/busqueda.blade.php -->
<div class="search-container">
    <input type="text" 
           id="search-input" 
           placeholder="Buscar libros..."
           autocomplete="off">
    
    <div id="search-results" class="search-results"></div>
</div>

<script>
document.getElementById('search-input').addEventListener('input', function(e) {
    const query = e.target.value.trim();
    const resultsContainer = document.getElementById('search-results');
    
    // Limpiar resultados anteriores
    resultsContainer.innerHTML = '';
    
    if (query.length < 2) {
        return;
    }
    
    // Debounce: esperar 300ms despu√©s de la √∫ltima tecla
    clearTimeout(this.timeout);
    this.timeout = setTimeout(() => {
        fetch(`/buscar-libros?q=${encodeURIComponent(query)}`)
            .then(response => response.json())
            .then(data => {
                if (data.length === 0) {
                    resultsContainer.innerHTML = '<div class="no-results">No se encontraron resultados</div>';
                    return;
                }
                
                data.forEach(libro => {
                    const item = document.createElement('a');
                    item.href = `/libros/${libro.id}`;
                    item.className = 'search-item';
                    item.innerHTML = `
                        <img src="${libro.imagen || '/default-book.png'}" alt="${libro.titulo}">
                        <div>
                            <strong>${libro.titulo}</strong>
                            <small>${libro.autor}</small>
                        </div>
                    `;
                    resultsContainer.appendChild(item);
                });
            })
            .catch(error => {
                console.error('Error en b√∫squeda:', error);
            });
    }, 300);
});

// Ocultar resultados al hacer clic fuera
document.addEventListener('click', function(e) {
    if (!e.target.closest('.search-container')) {
        document.getElementById('search-results').innerHTML = '';
    }
});
</script>

<style>
.search-container {
    position: relative;
    width: 300px;
}

#search-input {
    width: 100%;
    padding: 10px;
    border: 1px solid #ddd;
    border-radius: 5px;
}

.search-results {
    position: absolute;
    top: 100%;
    left: 0;
    right: 0;
    background: white;
    border: 1px solid #ddd;
    border-radius: 5px;
    max-height: 400px;
    overflow-y: auto;
    z-index: 1000;
    box-shadow: 0 2px 10px rgba(0,0,0,0.1);
}

.search-item {
    display: flex;
    align-items: center;
    padding: 10px;
    text-decoration: none;
    color: #333;
    border-bottom: 1px solid #eee;
    transition: background 0.2s;
}

.search-item:hover {
    background: #f5f5f5;
}

.search-item img {
    width: 40px;
    height: 40px;
    object-fit: cover;
    margin-right: 10px;
    border-radius: 3px;
}

.search-item div {
    flex: 1;
}

.search-item strong {
    display: block;
    font-size: 14px;
}

.search-item small {
    color: #666;
    font-size: 12px;
}

.no-results {
    padding: 20px;
    text-align: center;
    color: #666;
}
</style>

4. Ejemplo PR√ÅCTICO 3: Carga Infinita de Libros
Paso 1: Controlador para Paginaci√≥n
php
public function index(Request $request)
{
    $perPage = 12;
    $page = $request->input('page', 1);
    
    $libros = Libro::with('autor')
        ->orderBy('created_at', 'desc')
        ->paginate($perPage, ['*'], 'page', $page);
    
    if ($request->ajax()) {
        // Si es petici√≥n AJAX, devolver solo HTML de los libros
        $view = view('libros.partials.libros-grid', ['libros' => $libros])->render();
        
        return response()->json([
            'html' => $view,
            'hasMorePages' => $libros->hasMorePages()
        ]);
    }
    
    // Vista normal
    return view('libros.index', compact('libros'));
}
Paso 2: Vista Principal
blade
<!-- resources/views/libros/index.blade.php -->
<div id="libros-container">
    @include('libros.partials.libros-grid', ['libros' => $libros])
</div>

@if($libros->hasMorePages())
<div id="load-more-container">
    <button id="load-more-btn" class="btn btn-primary">
        Cargar m√°s libros
    </button>
    
    <div id="loading-spinner" style="display: none;">
        <i class="fas fa-spinner fa-spin"></i> Cargando...
    </div>
</div>
@endif

<script>
let currentPage = 1;
const loadMoreBtn = document.getElementById('load-more-btn');
const loadingSpinner = document.getElementById('loading-spinner');
const librosContainer = document.getElementById('libros-container');

if (loadMoreBtn) {
    loadMoreBtn.addEventListener('click', function() {
        currentPage++;
        
        // Mostrar loading, ocultar bot√≥n
        loadMoreBtn.style.display = 'none';
        loadingSpinner.style.display = 'block';
        
        fetch(`/libros?page=${currentPage}`, {
            headers: {
                'X-Requested-With': 'XMLHttpRequest'
            }
        })
        .then(response => response.json())
        .then(data => {
            // A√±adir nuevos libros
            librosContainer.insertAdjacentHTML('beforeend', data.html);
            
            // Actualizar bot√≥n si hay m√°s p√°ginas
            if (data.hasMorePages) {
                loadMoreBtn.style.display = 'block';
            } else {
                document.getElementById('load-more-container').innerHTML = 
                    '<p class="text-center">No hay m√°s libros</p>';
            }
        })
        .catch(error => {
            console.error('Error:', error);
            loadMoreBtn.style.display = 'block';
        })
        .finally(() => {
            loadingSpinner.style.display = 'none';
        });
    });
}

// Carga infinita autom√°tica al hacer scroll
window.addEventListener('scroll', function() {
    if (window.innerHeight + window.scrollY >= document.body.offsetHeight - 500) {
        if (loadMoreBtn && loadMoreBtn.style.display !== 'none') {
            loadMoreBtn.click();
        }
    }
});
</script>
Paso 3: Partial para Grid de Libros
blade
<!-- resources/views/libros/partials/libros-grid.blade.php -->
<div class="row">
    @foreach($libros as $libro)
    <div class="col-md-3 mb-4">
        <div class="card libro-card">
            <img src="{{ $libro->portada }}" class="card-img-top" alt="{{ $libro->titulo }}">
            <div class="card-body">
                <h5 class="card-title">{{ $libro->titulo }}</h5>
                <p class="card-text">{{ Str::limit($libro->descripcion, 100) }}</p>
                <a href="{{ route('libros.show', $libro) }}" class="btn btn-sm btn-primary">
                    Ver detalles
                </a>
            </div>
        </div>
    </div>
    @endforeach
</div>

üõ°Ô∏è SEGURIDAD CON AJAX EN LARAVEL
Protecci√≥n CSRF
javascript
// Incluir token en todas las peticiones POST/PUT/DELETE
headers: {
    'X-CSRF-TOKEN': document.querySelector('meta[name="csrf-token"]').content
}
Validar en el Backend
php
// Siempre validar aunque sea petici√≥n AJAX
public function store(Request $request)
{
    $validated = $request->validate([
        'titulo' => 'required|max:255',
        'contenido' => 'required'
    ]);
    
    // Verificar permisos
    if (!auth()->user()->can('create', Libro::class)) {
        return response()->json([
            'error' => 'No autorizado'
        ], 403);
    }
    
    // ... resto del c√≥digo
}

üîç DEPURACI√ìN DE AJAX
Herramientas del Navegador
F12 ‚Üí Network tab: Ver peticiones AJAX
Console tab: Ver errores JavaScript
Preview/Response: Ver respuesta del servidor
Debug en Laravel
php
// Loggear datos recibidos
\Log::info('Datos AJAX recibidos:', $request->all());

// Devolver informaci√≥n de debug
return response()->json([
    'success' => false,
    'error' => 'Mensaje de error',
    'debug' => [
        'input' => $request->all(),
        'user' => auth()->user()->id ?? null
    ]
], 400);

üìä FORMATOS DE RESPUESTA
JSON (Recomendado)
php
return response()->json([
    'success' => true,
    'data' => $libro,
    'message' => 'Operaci√≥n exitosa'
]);
HTML (Para actualizar partes de la vista)
php
$view = view('partials.libro-item', ['libro' => $libro])->render();
return response()->json(['html' => $view]);
HTTP Status Codes
200 OK - √âxito
201 Created - Creado
400 Bad Request - Error en datos
401 Unauthorized - No autenticado
403 Forbidden - No tiene permisos
404 Not Found - No existe
422 Unprocessable Entity - Validaci√≥n fall√≥
500 Server Error - Error interno

‚ö° MEJORES PR√ÅCTICAS
1. Usar Debounce para B√∫squedas
javascript
let timeout;
input.addEventListener('input', function() {
    clearTimeout(timeout);
    timeout = setTimeout(() => {
        // Hacer petici√≥n AJAX
    }, 300); // Esperar 300ms
});
2. Mostrar Feedback al Usuario
javascript
// Antes de enviar
button.disabled = true;
button.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Procesando...';

// Despu√©s de recibir respuesta
button.disabled = false;
button.innerHTML = 'Texto original';
3. Manejar Errores Elegantemente
javascript
fetch('/api/data')
    .then(response => {
        if (!response.ok) {
            throw new Error(`HTTP ${response.status}`);
        }
        return response.json();
    })
    .then(data => {
        // √âxito
    })
    .catch(error => {
        // Mostrar mensaje amigable
        showNotification('Error', 'No se pudo completar la operaci√≥n', 'error');
        console.error('Detalles:', error);
    });
4. Usar async/await (JavaScript moderno)
javascript
async function cargarLibros(pagina) {
    try {
        const response = await fetch(`/libros?page=${pagina}`);
        const data = await response.json();
        
        // Procesar datos
        return data;
    } catch (error) {
        console.error('Error:', error);
        throw error;
    }
}

üîÑ AJAX vs Livewire vs Inertia.js
AJAX Tradicional (Lo que vimos)
Ventajas: Control total, flexible, no dependencias extra
Desventajas: M√°s c√≥digo manual, puede ser complejo
Livewire (Recomendado para Laravel)
bash
composer require livewire/livewire
Maneja AJAX autom√°ticamente
C√≥digo PHP en el backend, actualiza frontend autom√°ticamente
Perfecto para CRUDs simples
Inertia.js
Para SPAs (Single Page Applications)
M√°s complejo pero m√°s potente
Mezcla Laravel con Vue.js/React

üéØ EJERCICIO PR√ÅCTICO: Sistema de Comentarios con AJAX
Objetivo:
Crear comentarios en libros que se a√±adan sin recargar la p√°gina.
Pasos:
Migraci√≥n para tabla comentarios
Modelo Comentario con relaci√≥n a Libro y User
Ruta POST /libros/{id}/comentarios
Controlador para guardar comentario
Vista con formulario AJAX
JavaScript para enviar y mostrar comentario

‚ùì PREGUNTAS FRECUENTES
¬øAJAX funciona sin JavaScript?
‚ùå NO. El usuario debe tener JavaScript habilitado.
¬øC√≥mo probar AJAX en desarrollo local?
‚úÖ Usa php artisan serve y accede desde el navegador.
¬øAJAX afecta al SEO?
‚ö†Ô∏è S√≠. Google puede indexar contenido cargado por AJAX, pero es mejor tener contenido inicial en HTML.
¬øPuedo usar AJAX con Blade?
‚úÖ S√ç. Puedes devolver vistas Blade como respuesta AJAX.
¬øC√≥mo manejar sesiones con AJAX?
‚úÖ Laravel maneja sesiones autom√°ticamente, igual que con peticiones normales.

üìö RECURSOS ADICIONALES
Librer√≠as √∫tiles:
Axios: Mejor para peticiones HTTP
Sweetalert2: Alertas bonitas
Toastr: Notificaciones toast
Select2: Selects con b√∫squeda AJAX
Comandos √∫tiles:
bash
# Instalar dependencias
npm install axios sweetalert2

# Compilar assets
npm run dev
npm run watch  # Para desarrollo (recarga autom√°tica)

